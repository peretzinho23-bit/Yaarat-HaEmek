<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>מבחנים – יערת העמק</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body data-page="exams">
  <!-- HEADER פשוט -->
  <header class="header-main">
    <div class="container">
      <nav class="nav">
        <div class="nav-left">
          <div class="logo-circle">
            <span>יערת<br>העמק</span>
          </div>
          <div>
            <div class="school-title-main">לוח מבחנים לכיתות</div>
            <div class="school-title-sub">
              <a href="index.html">חזרה לאתר התלמידים</a>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <section class="section-light">
    <div class="container">
      <div class="section-header">
        <h1 class="section-title" id="exams-title">מבחנים</h1>
        <p class="section-subtitle" id="exams-subtitle">
          כאן תראו את כל המבחנים שהוזנו לאתר עבור הכיתה שבחרתם.
        </p>
      </div>

      <div id="exams-list" class="home-board-list">
        <p class="empty-msg">טוען מבחנים...</p>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>© כל הזכויות שמורות לבית ספר יערת העמק</p>
    </div>
  </footer>

  <script type="module">
    import { db } from "./firebase-config.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // מפה classId → טקסט יפה
    const CLASS_LABELS = {
      z1: "ז1", z2: "ז2", z3: "ז3", z4: "ז4", z5: "ז5",
      h1: "ח1", h2: "ח2", h3: "ח3", h4: "ח4", h5: "ח5", h6: "ח6",
      t1: "ט1", t2: "ט2", t3: "ט3", t4: "ט4", t5: "ט5"
    };

    const GRADE_LABELS = {
      z: "שכבת ז'",
      h: "שכבת ח'",
      t: "שכבת ט'"
    };

    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const classId = getQueryParam("class"); // לדוגמה z1
    const examsTitleEl = document.getElementById("exams-title");
    const examsSubtitleEl = document.getElementById("exams-subtitle");
    const listEl = document.getElementById("exams-list");

    if (!classId) {
      examsTitleEl.textContent = "שגיאה";
      examsSubtitleEl.textContent = "לא הועברה כיתה בכתובת.";
      listEl.innerHTML = `<p class="empty-msg">נראה שהגעתם לכאן בלי לבחור כיתה.</p>`;
    } else {
      const niceClassLabel = CLASS_LABELS[classId] || classId;
      const gradeKey = classId[0]; // z / h / t
      const gradeLabel = GRADE_LABELS[gradeKey] || "";

      examsTitleEl.textContent = `מבחנים – כיתה ${niceClassLabel}`;
      examsSubtitleEl.textContent = `${gradeLabel} · כל המבחנים שהוזנו לאתר עבור כיתה זו.`;

      loadExamsForClass(classId);
    }

    async function loadExamsForClass(classId) {
      try {
        const refDoc = doc(db, "exams", classId);
        const snap = await getDoc(refDoc);

        if (!snap.exists()) {
          listEl.innerHTML = `<p class="empty-msg">אין עדיין מבחנים לכיתה זו.</p>`;
          return;
        }

        const data = snap.data() || {};
        const items = data.items || [];

        if (!items.length) {
          listEl.innerHTML = `<p class="empty-msg">אין עדיין מבחנים לכיתה זו.</p>`;
          return;
        }

        // מציגים כל מבחן ככרטיס
        listEl.innerHTML = items.map(ex => {
          const date = ex.date || "";
          const time = ex.time || "";
          const subject = ex.subject || "";
          const topic = ex.topic || "";
          const imageUrl = ex.imageUrl || "";

          const metaParts = [];
          if (date) metaParts.push(date);
          if (time) metaParts.push(time);

          const metaText = metaParts.join(" · ");

          const imgHtml = imageUrl
            ? `<div style="margin-top:8px;">
                 <img src="${imageUrl}" style="max-width:100%;border-radius:12px;border:1px solid #e2e8f0;">
               </div>`
            : "";

          return `
            <article class="card" style="margin-bottom:12px;">
              <h3 style="margin-bottom:4px;">${subject}</h3>
              <p class="card-meta">${metaText}</p>
              <p style="margin-top:6px;font-size:0.95rem;">${topic}</p>
              ${imgHtml}
            </article>
          `;
        }).join("");
      } catch (err) {
        console.error("שגיאה בטעינת מבחנים:", err);
        listEl.innerHTML = `<p class="empty-msg">הייתה שגיאה בטעינת המבחנים. נסו שוב מאוחר יותר.</p>`;
      }
    }
  </script>
</body>
</html>
