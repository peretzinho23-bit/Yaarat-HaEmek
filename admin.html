<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>לוח ניהול – יערת העמק</title>

  <!-- האתר הכללי (לרכיבים/כפתורים בסיסיים) -->
  <link rel="stylesheet" href="style.css" />
  <!-- האדמין (אמור לנצח הכל) -->
  <link rel="stylesheet" href="admin.css" />

  <!-- ✅ נועל את האדמין על DARK ולא נותן לאתר להשפיע -->
  <script>
    (function () {
      try {
        document.documentElement.setAttribute("data-theme", "dark");
        document.documentElement.classList.remove("theme-changing");
      } catch {}
    })();
  </script>

  <!-- התאמות ספציפיות לאדמין: תמונות קטנות + רשימות קומפקטיות -->
  <style>
    /* כרטיס אדמין כללי */
    .admin-list .admin-item {
      padding: 8px 10px;
      margin-bottom: 8px;
      border-radius: 12px;
    }

    /* שורת תמונות קטנה בחדשות / מודעות */
    .admin-images-row {
      display: flex;
      gap: 6px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .admin-image-wrapper {
      width: 90px;
      height: 70px;
      flex: 0 0 auto;
      overflow: hidden;
      border-radius: 8px;
    }

    .admin-image-wrapper img.admin-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* טקסט קצר יותר כדי שלא ייקח חצי מסך */
    .admin-item-body {
      font-size: 0.9rem;
      line-height: 1.45;
      max-height: 6.5em;
      overflow-y: auto;
    }

    /* כותרות מבחנים באדמין – קצת מרווח */
    .admin-class-title {
      font-size: 0.95rem;
      margin-top: 10px;
      margin-bottom: 4px;
      opacity: 0.9;
    }

    .admin-exam-item {
      border-radius: 10px;
      padding: 6px 8px;
      margin-bottom: 6px;
    }

    /* ✅ חשוב: לא לשים פה עיצובי light/dark של האדמין.
       כל זה צריך להיות ב-admin.css כדי שלא יהיה ערבוב עם האתר. */
  </style>
</head>

<body class="admin-page" data-page="admin">
  <!-- ✅ רק פעם אחת -->
  <script type="module" src="analytics.js"></script>

  <!-- HEADER -->
  <header class="header-main">
    <div class="container">
      <nav class="nav nav-centered" aria-label="כותרת אדמין">

        <!-- מרכז (לוגו) -->
        <div class="nav-center">
          <a href="index.html" class="logo-circle" aria-label="דף הבית">
            <img
              src="https://i.ibb.co/tp4K737Y/Cropped-circle-image-1.png"
              alt="סמל יערת העמק"
              class="logo-img"
            />
          </a>
        </div>

        <!-- כותרת באמצע אמיתי (ממומש ב-admin.css) -->
        <div class="admin-header-title">מערכת ניהול · יערת העמק</div>

      </nav>
    </div>
  </header>

  <!-- סיידבר שכבות לאדמין (מחוץ ל-header) -->
  <div class="admin-grade-switcher">
    <button class="grade-filter-btn active" data-grade="all">כל השכבות</button>
    <button class="grade-filter-btn" data-grade="z">שכבת ז'</button>
    <button class="grade-filter-btn" data-grade="h">שכבת ח'</button>
    <button class="grade-filter-btn" data-grade="t">שכבת ט'</button>
  </div>

  <section>
    <div class="container">

      <p id="auth-status" class="section-subtitle">בודק התחברות...</p>

      <!-- LOGIN -->
      <div id="login-section">
        <div class="section-header">
          <h2 class="section-title">התחברות אדמין</h2>
          <p class="section-subtitle">כניסה למנהלי המערכת בלבד</p>
        </div>

        <form id="login-form" style="max-width:360px;margin:0 auto;">
          <label>אימייל</label>
          <input type="email" name="email" required />

          <label>סיסמה</label>
          <input type="password" name="password" required />

          <button type="submit" style="width:100%;margin-top:10px;">כניסה</button>
        </form>

        <div style="max-width:360px;margin:15px auto 0;text-align:center;">
          <p class="section-subtitle" style="margin-bottom:8px;">
            אין לך משתמש אדמין?
          </p>
          <a href="register.html" class="btn-outline" style="display:inline-block;padding:8px 16px;border-radius:999px;">
            בקשת הרשמה
          </a>
        </div>
      </div>

      <!-- ADMIN PANEL -->
      <div id="admin-section" class="admin-layout" style="display:none;">
        <button id="logout-btn" class="btn-outline">התנתקות</button>

        <div class="section-header">
          <h2 class="section-title">ניהול חדשות, מבחנים, מודעות ותוכן האתר</h2>
          <p class="section-subtitle">
            כל שינוי נשמר אוטומטית ונראה באתר התלמידים.
          </p>
        </div>

        <!-- כפתורי ניהול מהירים -->
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;">
          <a
            href="adminapps.html"
            target="_blank"
            class="btn-outline"
            style="display:inline-block;padding:8px 16px;border-radius:999px;"
          >
            כלי עריכה נוספים 🛠️    קוד כניסה - 1992
          </a>
        </div>

        <!-- NEWS -->
        <h3 class="section-title" style="font-size:1.2rem;margin-bottom:10px;">חדשות לפי כיתות</h3>
        <p class="section-subtitle">
          ניתן להוסיף עד שתי תמונות לידיעה (קישורים או קבצים) + צבע טקסט (אופציונלי).
        </p>

        <div class="admin-columns">

          <!-- NEWS Z -->
          <section class="admin-grade-section" data-grade="z">
            <div class="card">
              <h3>שכבת ז'</h3>
              <div id="admin-news-z" class="admin-list"></div>

              <form id="news-form-z">
                <label>כיתה</label>
                <select name="classId" required>
                  <option value="">בחר כיתה</option>
                  <option value="z1">ז1</option>
                  <option value="z2">ז2</option>
                  <option value="z3">ז3</option>
                  <option value="z4">ז4</option>
                  <option value="z5">ז5</option>
                </select>

                <label>כותרת</label>
                <input name="title" />

                <label>מידע קצר (תאריך/אירוע)</label>
                <input name="meta" />

                <label>קישור לתמונה 1 (אופציונלי)</label>
                <input name="imageUrl" placeholder="https://..." />

                <label>תמונה 1 מקובץ (אופציונלי)</label>
                <input type="file" name="imageFile" accept="image/*" />

                <label>קישור לתמונה 2 (אופציונלי)</label>
                <input name="imageUrl2" placeholder="https://..." />

                <label>תמונה 2 מקובץ (אופציונלי)</label>
                <input type="file" name="imageFile2" accept="image/*" />

                <label>צבע הטקסט (אופציונלי)</label>
                <input type="color" name="color" value="#ffffff" />

                <label>תוכן הידיעה</label>
                <textarea name="body"></textarea>

                <button type="submit">הוסף חדשות לז'</button>
              </form>
            </div>
          </section>

          <!-- NEWS H -->
          <section class="admin-grade-section" data-grade="h">
            <div class="card">
              <h3>שכבת ח'</h3>
              <div id="admin-news-h" class="admin-list"></div>

              <form id="news-form-h">
                <label>כיתה</label>
                <select name="classId" required>
                  <option value="">בחר כיתה</option>
                  <option value="h1">ח1/7</option>
                  <option value="h4">ח4/8</option>
                  <option value="h5">ח5/9</option>
                  <option value="h6">ח6/10</option>
                </select>

                <label>כותרת</label>
                <input name="title" />

                <label>מידע קצר (תאריך/אירוע)</label>
                <input name="meta" />

                <label>קישור לתמונה 1 (אופציונלי)</label>
                <input name="imageUrl" placeholder="https://..." />

                <label>תמונה 1 מקובץ (אופציונלי)</label>
                <input type="file" name="imageFile" accept="image/*" />

                <label>קישור לתמונה 2 (אופציונלי)</label>
                <input name="imageUrl2" placeholder="https://..." />

                <label>תמונה 2 מקובץ (אופציונלי)</label>
                <input type="file" name="imageFile2" accept="image/*" />

                <label>צבע הטקסט (אופציונלי)</label>
                <input type="color" name="color" value="#ffffff" />

                <label>תוכן הידיעה</label>
                <textarea name="body"></textarea>

                <button type="submit">הוסף חדשות לח'</button>
              </form>
            </div>
          </section>

          <!-- NEWS T -->
          <section class="admin-grade-section" data-grade="t">
            <div class="card">
              <h3>שכבת ט'</h3>
              <div id="admin-news-t" class="admin-list"></div>

              <form id="news-form-t">
                <label>כיתה</label>
                <select name="classId" required>
                  <option value="">בחר כיתה</option>
                  <option value="t1">ט1</option>
                  <option value="t2">ט2</option>
                  <option value="t3">ט3</option>
                  <option value="t4">ט4</option>
                  <option value="t5">ט5</option>
                </select>

                <label>כותרת</label>
                <input name="title" />

                <label>מידע קצר (תאריך/אירוע)</label>
                <input name="meta" />

                <label>קישור לתמונה 1 (אופציונלי)</label>
                <input name="imageUrl" placeholder="https://..." />

                <label>תמונה 1 מקובץ (אופציונלי)</label>
                <input type="file" name="imageFile" accept="image/*" />

                <label>קישור לתמונה 2 (אופציונלי)</label>
                <input name="imageUrl2" placeholder="https://..." />

                <label>תמונה 2 מקובץ (אופציונלי)</label>
                <input type="file" name="imageFile2" accept="image/*" />

                <label>צבע הטקסט (אופציונלי)</label>
                <input type="color" name="color" value="#ffffff" />

                <label>תוכן הידיעה</label>
                <textarea name="body"></textarea>

                <button type="submit">הוסף חדשות לט'</button>
              </form>
            </div>
          </section>

        </div>

        <br><br>

        <!-- EXAMS -->
        <h3 class="section-title" style="font-size:1.2rem;margin-bottom:10px;">לוח מבחנים - נא לא למחוק מבחנים קיימים.</h3>

        <div class="admin-columns">
          <!-- Z EXAMS -->
          <section class="admin-grade-section" data-grade="z">
            <div class="card">
              <h3>מבחנים · ז'</h3>
              <div id="admin-exams-z" class="admin-list"></div>

              <form id="exams-form-z" class="admin-form" data-grade="z">
                <label>תאריך המבחן</label>
                <input name="date" type="text" placeholder="למשל: 22/10/24" required />

                <label>שעת המבחן</label>
                <input type="time" name="time" />

                <label>מקצוע</label>
                <input name="subject" />

                <label>כיתה</label>
                <select name="classId" required>
                  <option value="">בחר כיתה</option>
                  <option value="z1">ז1</option>
                  <option value="z2">ז2</option>
                  <option value="z3">ז3</option>
                  <option value="z4">ז4</option>
                  <option value="z5">ז5</option>
                </select>

                <label>נושא המבחן</label>
                <textarea name="topic"></textarea>

                <label>קישור לתמונה (אופציונלי)</label>
                <input name="imageUrl" placeholder="https://..." />

                <button type="submit">הוסף מבחן לז'</button>
              </form>
            </div>
          </section>

          <!-- H EXAMS -->
          <section class="admin-grade-section" data-grade="h">
            <div class="card">
              <h3>מבחנים · ח'</h3>
              <div id="admin-exams-h" class="admin-list"></div>

              <form id="exams-form-h" class="admin-form" data-grade="h">
                <label>תאריך המבחן</label>
                <input name="date" type="text" placeholder="למשל: 22/10/24" required />

                <label>שעת המבחן</label>
                <input name="time" type="time" />

                <label>מקצוע</label>
                <input name="subject" />

                <label>כיתה</label>
                <select name="classId" required>
                  <option value="">בחר כיתה</option>
                  <option value="h1">ח1/7</option>
                  <option value="h4">ח4/8</option>
                  <option value="h5">ח5/9</option>
                  <option value="h6">ח6/10</option>
                </select>

                <label>נושא המבחן</label>
                <textarea name="topic"></textarea>

                <label>קישור לתמונה (אופציונלי)</label>
                <input name="imageUrl" placeholder="https://..." />

                <button type="submit">הוסף מבחן לח'</button>
              </form>
            </div>
          </section>

          <!-- T EXAMS -->
          <section class="admin-grade-section" data-grade="t">
            <div class="card">
              <h3>מבחנים · ט'</h3>
              <div id="admin-exams-t" class="admin-list"></div>

              <form id="exams-form-t" class="admin-form" data-grade="t">
                <label>תאריך המבחן</label>
                <input name="date" type="text" placeholder="למשל: 22/10/24" required />

                <label>שעת המבחן</label>
                <input name="time" type="time" />

                <label>מקצוע</label>
                <input name="subject" />

                <label>כיתה</label>
                <select name="classId" required>
                  <option value="">בחר כיתה</option>
                  <option value="t1">ט1</option>
                  <option value="t2">ט2</option>
                  <option value="t3">ט3</option>
                  <option value="t4">ט4</option>
                  <option value="t5">ט5</option>
                </select>

                <label>נושא המבחן</label>
                <textarea name="topic"></textarea>

                <label>קישור לתמונה (אופציונלי)</label>
                <input name="imageUrl" placeholder="https://..." />

                <button type="submit">הוסף מבחן לט'</button>
              </form>
            </div>
          </section>
        </div>

        <br><br>

        <div class="card" style="margin-top:16px;">
          <h3 style="margin:0 0 10px;">הודעה דחופה</h3>

          <label style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
            <input type="checkbox" id="urgentActive">
            <span>פעילה</span>
          </label>

          <label style="display:block; margin-bottom:8px; font-weight:800;">סוג</label>
          <select id="urgentType" style="width:100%; padding:10px; border-radius:12px; margin-bottom:10px;">
            <option value="info">רגילה (כחול)</option>
            <option value="warn">אזהרה (צהוב)</option>
            <option value="danger">דחוף (אדום)</option>
          </select>

          <label style="display:block; margin-bottom:8px; font-weight:800;">טקסט</label>
          <textarea id="urgentText" rows="3" style="width:100%; padding:10px; border-radius:12px;"></textarea>

          <label>צבע הודעה</label>
          <input id="urgentColor" type="color" value="#fbbf24">

          <div style="display:flex; gap:10px; margin-top:10px;">
            <button id="urgentSave" class="btn">שמירה</button>
            <button id="urgentClear" class="btn" style="opacity:.85;">מחיקה</button>
          </div>

          <div id="urgentStatus" style="margin-top:10px; opacity:.8;"></div>
        </div>

        <!-- BOARD -->
        <h3 class="section-title" style="font-size:1.2rem;margin-bottom:10px;">
          לוח מודעות
          נא לא למחוק מודעות אחרות,זה מוחק את דף הכתבה
        </h3>

        <div class="admin-columns">
          <div class="card">
            <h3>מודעות כלליות</h3>
            <div id="admin-board" class="admin-list"></div>

            <form id="board-form">
              <label>כותרת</label>
              <input name="title" />

              <label>מידע קצר (מי קהל היעד, תאריך וכו')</label>
              <input name="meta" />

              <label>צבע הטקסט (אופציונלי)</label>
              <input type="color" name="color" value="#ffffff" />

              <label>קישור לתמונה 1 (אופציונלי)</label>
              <input name="imageUrl" placeholder="https://..." />

              <label>העלה קובץ תמונה 1 (אופציונלי)</label>
              <input type="file" name="imageFile" accept="image/*" />

              <label>קישור לתמונה 2 (אופציונלי)</label>
              <input name="imageUrl2" placeholder="https://..." />

              <label>העלה קובץ תמונה 2 (אופציונלי)</label>
              <input type="file" name="imageFile2" accept="image/*" />

              <label>קישור לתמונה 3 (אופציונלי)</label>
              <input name="imageUrl3" placeholder="https://..." />

              <label>העלה קובץ תמונה 3 (אופציונלי)</label>
              <input type="file" name="imageFile3" accept="image/*" />

              <label>תוכן המודעה</label>
              <textarea name="body"></textarea>

              <button type="submit">הוסף מודעה</button>
            </form>
          </div>
        </div>

        <br><br>

        <!-- SITE CONTENT -->
        <h3 class="section-title" style="font-size:1.2rem;margin-bottom:10px;">ניהול תוכן האתר</h3>
        <p class="section-subtitle">
          כל השדות כאן נשמרים במסמך Firestore אחד (siteContent/main) ומוזנים לכל חלקי האתר.
        </p>

        <div class="admin-columns">
          <div class="card">
            <h3>טקסטים כלליים</h3>

            <form id="site-content-form" class="admin-form">
              <!-- HERO -->
              <h4>דף בית – אזור הירו (המשפטים הגדולים למעלה)</h4>

              <label>כותרת ראשית בהירו</label>
              <input name="homeHeroTitle" placeholder="ברוכים הבאים ליערת העמק" />

              <label>תת־כותרת בהירו</label>
              <input name="homeHeroSubtitle" placeholder="סביבת למידה בטוחה, תומכת ומובילה..." />

              <h4 style="margin-top:16px;">תיבת "מידע מהיר" בהירו</h4>

              <label>כותרת התיבה</label>
              <input name="heroSideTitle" placeholder="מידע מהיר" />

              <label>שורות 'מידע מהיר' (כל שורה – שורה בנפרד ברשימה)</label>
              <textarea
                name="heroSideList"
                rows="3"
                placeholder="📍 מגדל העמק&#10;🧑‍🎓 שכבות ז'–ט'&#10;👩‍🏫 צוות חינוכי מסור&#10;🤝 שיתופי פעולה קהילתיים"
              ></textarea>

              <h4 style="margin-top:16px;">אודות בית הספר</h4>

              <label>כותרת אודות</label>
              <input name="aboutTitle" placeholder="אודות בית הספר יערת העמק" />

              <label>טקסט אודות</label>
              <textarea name="aboutBody" rows="4" placeholder="כמה משפטים על בית הספר, הערכים, האווירה..."></textarea>

              <h4 style="margin-top:16px;">מדור "חשוב לדעת"</h4>

              <label>כותרת המדור</label>
              <input name="importantTitle" placeholder="חשוב לדעת" />

              <label>תת־כותרת המדור</label>
              <input name="importantSubtitle" placeholder="כמה דברים שימושיים לתלמידים – לפני שממשיכים לגלול." />

              <h5 style="margin-top:10px;">כרטיס 1</h5>
              <label>כותרת כרטיס 1</label>
              <input name="importantCard1Title" placeholder="לדוגמה: 💻 סביבת למידה דיגיטלית" />
              <label>טקסט כרטיס 1</label>
              <textarea name="importantCard1Body" rows="2"></textarea>

              <h5 style="margin-top:10px;">כרטיס 2</h5>
              <label>כותרת כרטיס 2</label>
              <input name="importantCard2Title" placeholder="לדוגמה: 🤝 עם מי מדברים?" />
              <label>טקסט כרטיס 2</label>
              <textarea name="importantCard2Body" rows="2"></textarea>

              <h5 style="margin-top:10px;">כרטיס 3</h5>
              <label>כותרת כרטיס 3</label>
              <input name="importantCard3Title" placeholder="לדוגמה: 📌 טיפ נוסף" />
              <label>טקסט כרטיס 3</label>
              <textarea name="importantCard3Body" rows="2"></textarea>

              <h4 style="margin-top:16px;">כותרות למדורי דף הבית</h4>

              <label>כותרת מדור חדשות</label>
              <input name="homeNewsTitle" placeholder="חדשות אחרונות" />

              <label>תת־כותרת מדור חדשות</label>
              <input name="homeNewsSubtitle" placeholder="שלושת העדכונים האחרונים מכל שכבה – ישר מול העיניים של התלמידים." />

              <label>כותרת מדור לוח מודעות</label>
              <input name="boardTitle" placeholder="לוח מודעות" />

              <label>תת־כותרת מדור לוח מודעות</label>
              <input name="boardSubtitle" placeholder="הודעות חשובות, פעילויות ואירועים לבית הספר." />

              <label>כותרת מדור מבחנים</label>
              <input name="homeExamsTitle" placeholder="מבחנים קרובים" />

              <label>תת־כותרת מדור מבחנים</label>
              <input name="homeExamsSubtitle" placeholder="תאריכים, מקצועות ונושאים – כדי שאף אחד לא יפספס." />

              <h4 style="margin-top:16px;">מדור "היכרות עם השכבות"</h4>

              <label>כותרת המדור</label>
              <input name="gradesSectionTitle" placeholder="היכרות עם השכבות" />

              <label>תת־כותרת המדור</label>
              <input name="gradesSectionSubtitle" placeholder="בחר שכבה כדי לראות חדשות, מבחנים ועדכונים שמתאימים אליך." />

              <h5 style="margin-top:10px;">תיאור שכבות</h5>

              <label>תיאור שכבת ז'</label>
              <textarea name="zDescription" rows="2" placeholder="משפט על שכבת ז'..."></textarea>

              <label>תיאור שכבת ח'</label>
              <textarea name="hDescription" rows="2" placeholder="משפט על שכבת ח'..."></textarea>

              <label>תיאור שכבת ט'</label>
              <textarea name="tDescription" rows="2" placeholder="משפט על שכבת ט'..."></textarea>

              <h4 style="margin-top:16px;">תיבת בקשות</h4>

              <label>כותרת המדור</label>
              <input name="requestsTitle" placeholder="תיבת בקשות" />

              <label>תת־כותרת</label>
              <input name="requestsSubtitle" placeholder="רוצים לבקש משהו? יש רעיון?" />

              <label>טקסט מעל הכפתור</label>
              <textarea name="requestsBody" rows="2" placeholder="למילוי טופס הבקשות – לחצו כאן:"></textarea>

              <h4 style="margin-top:16px;">יצירת קשר</h4>

              <label>כותרת המדור</label>
              <input name="contactSectionTitle" placeholder="יצירת קשר" />

              <label>תת־כותרת המדור</label>
              <input name="contactSectionSubtitle" placeholder="ניתן לפנות אלינו בכל שאלה, בקשה או התייעצות." />

              <label>טלפון</label>
              <input name="contactPhone" placeholder="04-XXXXXXX" />

              <label>אימייל</label>
              <input name="contactEmail" placeholder="school@example.com" />

              <label>כתובת</label>
              <input name="contactAddress" placeholder="רחוב..., מגדל העמק" />

              <h4 style="margin-top:16px;">פוטר</h4>

              <label>טקסט תחתון (פוטר)</label>
              <input name="footerText" placeholder="© כל הזכויות שמורות לבית ספר יערת העמק" />

              <button type="submit" style="margin-top:16px;">שמור תוכן אתר</button>
            </form>
          </div>
        </div>

      </div><!-- /#admin-section -->

    </div><!-- /.container -->
  </section>

  <script type="module" src="admin.js?v=7"></script>
  <script type="module" src="./admin-urgent.js"></script>
  <script src="accessibility.js"></script>
</body>
</html>
