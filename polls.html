<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />

  <title>×¡×§×¨×™× ×œ×ª×œ××™×“×™× â€“ ×™×¢×¨×ª ×”×¢××§</title>

  <link rel="icon" href="logo.png" />
  <link rel="stylesheet" href="style.css" />

  <style>
    /* ========= ×“×£ ×¡×§×¨×™× â€“ ×™×™×¢×•×“×™ ========= */
            #home-poll-mini{ padding:32px 0; }

    .home-poll-card{
      max-width:720px; margin:0 auto;
      border-radius:24px;
      padding:18px 18px 14px;
      background: rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.5);
      box-shadow:0 18px 45px rgba(15,23,42,0.85);
      transition: background-color .25s ease, border-color .25s ease, box-shadow .25s ease, color .25s ease;
    }
    .home-poll-header{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
    .home-poll-badge{
      border-radius:999px; padding:4px 10px;
      font-size:.75rem;
      background:rgba(56,189,248,0.14);
      border:1px solid rgba(56,189,248,0.7);
      color:#bae6fd;
    }
    .home-poll-status-text{ font-size:.8rem; color:#9ca3af; }
    .home-poll-body{ margin-bottom:10px; }
    .home-poll-question{ font-size:1rem; font-weight:600; margin-bottom:8px; color:#e5f0ff; }

    .home-poll-options{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:6px; }
    .home-poll-option{
      border-radius:999px;
      padding:6px 10px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(51,65,85,0.9);
      font-size:.85rem;
      color:#e5e7eb;
      display:flex; justify-content:space-between; align-items:center; gap:6px;
    }
    .home-poll-option-label{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .home-poll-option-votes{ font-size:.75rem; color:#cbd5f5; white-space:nowrap; }

    .home-poll-footer{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; font-size:.8rem; }
    .home-poll-votes{ color:#9ca3af; }
    .home-poll-link{
      font-size:.8rem; text-decoration:none;
      border-radius:999px; padding:6px 10px;
      border:1px solid rgba(56,189,248,0.7);
      background:rgba(15,23,42,0.9);
      color:#7dd3fc;
    }
    .home-poll-link:hover{ text-decoration:underline; }

    :root[data-theme="light"] .home-poll-card{ background:#fff; border-color:rgba(15,23,42,0.08); box-shadow:0 12px 35px rgba(15,23,42,0.08); }
    :root[data-theme="light"] .home-poll-badge{ background:rgba(37,99,235,0.1); border-color:rgba(37,99,235,0.55); color:#1d4ed8; }
    :root[data-theme="light"] .home-poll-status-text{ color:#4b5563; }
    :root[data-theme="light"] .home-poll-question{ color:#111827; }
    :root[data-theme="light"] .home-poll-option{ background:#f9fafb; border-color:#e5e7eb; color:#111827; }
    :root[data-theme="light"] .home-poll-option-votes{ color:#4b5563; }
    :root[data-theme="light"] .home-poll-votes{ color:#6b7280; }
    :root[data-theme="light"] .home-poll-link{ background:#eff6ff; border-color:#2563eb; color:#1d4ed8; }
    @media (max-width:640px){ .home-poll-card{ padding:16px 14px 12px; } }

    #home-news .home-board-list > *:not(:first-child){ display:none !important; }
    #home-news .home-board-list p{
      display:-webkit-box;
      -webkit-line-clamp:4;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .home-news-mini{ margin-top:8px; }
    .home-news-mini-item{ display:flex; align-items:center; gap:10px; }
    .home-news-mini-thumb-wrap{ flex:0 0 56px; height:56px; border-radius:12px; overflow:hidden; }
    .home-news-mini-thumb-wrap img{ width:100%; height:100%; object-fit:cover; display:block; }
    .home-news-mini-text{ flex:1; min-width:0; }
    .home-news-mini-title{ font-size:.9rem; font-weight:600; margin-bottom:2px; }
    .home-news-mini-body{ font-size:.8rem; color:#4b5563; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; }
    .home-news-mini-empty{ font-size:.8rem; color:#6b7280; }
    .mini-link-inline{ display:inline-block; margin-top:4px; font-size:.78rem; }

    .hero-home-inner{
      position:relative; z-index:1;
      padding-top:64px; padding-bottom:40px;
      display:flex; flex-direction:column; gap:24px;
    }
    .hero-home-header{ max-width:720px; margin:0 auto 8px; text-align:center; }
    .hero-home-cards{ display:grid; grid-template-columns:repeat(3, minmax(0, 1fr)); gap:18px; margin-top:18px; }
    .hero-quick-card ul{ margin:10px 0 0; padding-inline-start:1.1rem; font-size:.9rem; }
    @media (max-width:900px){
      .hero-home-inner{ padding-top:40px; }
      .hero-home-cards{ grid-template-columns:1fr; }
    }

    body[data-page="home"] .hero-home-header h1,
    body[data-page="home"] #hero-main-title{
      color:#fff;
      text-shadow:
        0 2px 16px rgba(0,0,0,.55),
        0 0 26px rgba(56,189,248,.35);
    }
    body[data-page="home"] .hero-home-header p,
    body[data-page="home"] #hero-main-body{
      color: rgba(255,255,255,.92);
      text-shadow: 0 2px 14px rgba(0,0,0,.45);
    }

    .hero.hero-home .hero-overlay{
      opacity: .38;
    }

    .hero-home-header .hero-glow-line{
      display:block;
      width:min(680px, 92vw);
      height:4px;
      margin:16px auto 0;
      border-radius:999px;
      background: linear-gradient(
        90deg,
        transparent 0%,
        #60a5fa 20%,
        #38bdf8 50%,
        #60a5fa 80%,
        transparent 100%
      );
      background-size:200% 100%;
      box-shadow: 0 0 18px rgba(56,189,248,.35), 0 8px 28px rgba(37,99,235,.25);
      opacity:.95;
      animation: heroGlowMove 5s linear infinite;
    }
    @keyframes heroGlowMove{
      from{ background-position:0% 50%; }
      to{ background-position:200% 50%; }
    }
    @media (max-width:768px){
      .hero-home-header .hero-glow-line{ height:3px; }
    }

    .hero-actions a,
    .hero-actions .btn,
    .hero-actions .btn-outline{
      border-radius:999px;
      padding:10px 18px;
      font-weight:800;
      letter-spacing:.2px;
      background: rgba(255,255,255,0.75);
      color:#0f172a;
      border:1px solid rgba(255,255,255,0.6);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow:0 8px 24px rgba(15,23,42,0.18);
      transition: all .25s ease;
    }
    .hero-actions a:hover{
      background: rgba(37,99,235,0.9);
      color:#fff;
      border-color: transparent;
      box-shadow:0 12px 35px rgba(37,99,235,0.45);
      transform: translateY(-1px);
    }
    html[data-theme="dark"] .hero-actions a,
    html[data-theme="dark"] .hero-actions .btn,
    html[data-theme="dark"] .hero-actions .btn-outline{
      background: rgba(255,255,255,0.18);
      color:#fff;
      border:1px solid rgba(255,255,255,0.35);
      box-shadow:0 10px 30px rgba(0,0,0,0.35);
    }

    .hero-home-cards .grade-card{
      border-radius:18px;
      padding:18px 18px 16px;
      border:1px solid rgba(255,255,255,0.40);
      background: rgba(255,255,255,0.92); /* ×¨×’×™×œ â€“ ×‘×¨×•×¨ */
      box-shadow:0 10px 26px rgba(15,23,42,0.12);
      transition: transform .2s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
    }

    .hero-home-cards .grade-card:hover{
      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(12px) saturate(135%);
      -webkit-backdrop-filter: blur(12px) saturate(135%);
      transform: translateY(-4px);
      box-shadow:0 18px 45px rgba(15,23,42,0.18);
      border-color: rgba(37,99,235,0.22);
    }

    .hero-home-cards .grade-card h3{
      margin:0 0 8px;
      font-size:1.05rem;
      font-weight:800;
      letter-spacing:.2px;
      color: rgba(15,23,42,0.92);
    }
    .hero-home-cards .grade-card p,
    .hero-home-cards .grade-card li{
      color: rgba(15,23,42,0.72);
      line-height:1.55;
    }

    .hero-home-cards .grade-card:nth-child(2){
      border-color: rgba(37,99,235,0.20);
      box-shadow:0 14px 34px rgba(37,99,235,0.10);
      position: relative;
    }
    .hero-home-cards .grade-card:nth-child(2)::before{
      content:"";
      position:absolute;
      inset:12px auto 12px 12px;
      width:4px;
      border-radius:999px;
      background: rgba(37,99,235,0.50);
    }

    /* DARK */
    html[data-theme="dark"] .hero-home-cards .grade-card{
      background: rgba(15,23,42,0.88);
      border-color: rgba(148,163,184,0.22);
      box-shadow:0 14px 40px rgba(0,0,0,0.45);
    }
    html[data-theme="dark"] .hero-home-cards .grade-card:hover{
      background: rgba(15,23,42,0.45);
      backdrop-filter: blur(12px) saturate(130%);
      -webkit-backdrop-filter: blur(12px) saturate(130%);
      border-color: rgba(56,189,248,0.28);
    }
    html[data-theme="dark"] .hero-home-cards .grade-card h3{ color: rgba(255,255,255,0.92); }
    html[data-theme="dark"] .hero-home-cards .grade-card p,
    html[data-theme="dark"] .hero-home-cards .grade-card li{ color: rgba(255,255,255,0.74); }
    html[data-theme="dark"] .hero-home-cards .grade-card:nth-child(2)::before{ background: rgba(56,189,248,0.55); }

    @media (max-width:900px){
      .hero-home-cards .grade-card{
        padding:16px 14px 14px;
        border-radius:16px;
      }
      .hero-home-cards .grade-card:hover{
        backdrop-filter: blur(10px) saturate(125%);
        -webkit-backdrop-filter: blur(10px) saturate(125%);
      }
      .hero-home-cards .grade-card:nth-child(2)::before{
        inset:12px auto 12px 10px;
      }
    }

    /* ---------- ALL NEWS BUTTON ---------- */
    .all-news-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 18px; margin-top:12px;
      font-size:.9rem; font-weight:600;
      text-decoration:none;
      color:#2563eb; background:#eff6ff;
      border:1px solid #bfdbfe; border-radius:999px;
      transition: background .25s ease, color .25s ease, transform .2s ease, box-shadow .25s ease;
    }
    .all-news-btn::before{ content:"ğŸ“°"; font-size:.95rem; }
    .all-news-btn:hover{ background:#2563eb; color:#fff; transform:translateY(-1px); box-shadow:0 8px 20px rgba(37,99,235,0.35); }
    :root[data-theme="dark"] .all-news-btn{ background:rgba(37,99,235,0.15); color:#93c5fd; border-color:rgba(37,99,235,0.4); }
    :root[data-theme="dark"] .all-news-btn:hover{ background:#2563eb; color:#fff; }

    .nav.nav-centered{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:10px 0; position:relative;
    }
    .nav-side{ display:flex; gap:10px; align-items:center; flex:1; }
    .nav-right-links{ justify-content:flex-start; }
    .nav-left-links{ justify-content:flex-end; }

    .logo-circle{
      width:74px; height:74px;
      border-radius:999px; overflow:hidden;
      border:2px solid rgba(59,130,246,0.35);
      background: rgba(255,255,255,0.9);
      box-shadow:0 10px 25px rgba(15,23,42,0.12);
      display:flex; align-items:center; justify-content:center;
    }
    .logo-img{ width:100%; height:100%; object-fit:cover; }
    html[data-theme="dark"] .logo-circle{
      background: rgba(15,23,42,0.55);
      border-color: rgba(56,189,248,0.35);
    }
    @media (max-width:900px){
      .logo-circle{ width:64px; height:64px; }
    }

    .nav-side a{
      padding:8px 14px;
      border-radius:999px;
      background: rgba(255,255,255,0.92);
      border:1px solid rgba(148,163,184,0.55);
      color:#0f172a;
      box-shadow:0 8px 20px rgba(15,23,42,0.08);
      font-size:.92rem;
      font-weight:600;
      letter-spacing:.2px;
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
    }
    .nav-side a:hover{
      transform: translateY(-1px);
      box-shadow:0 12px 28px rgba(15,23,42,0.12);
      background:#eff6ff;
    }
    html[data-theme="dark"] .nav-side a{
      background: rgba(15,23,42,0.55);
      color:#e5e7eb;
      border-color: rgba(148,163,184,0.35);
    }
    .nav-side .personal-btn{
      background:#1d4ed8;
      color:#fff;
      border:none;
      font-weight:800;
    }
    .nav-side .btn-outline{ opacity:.85; }

    .theme-toggle-btn{
      all:unset;
      box-sizing:border-box;
      width:44px; height:44px;
      border-radius:50%;
      display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer;
      border:1px solid rgba(148,163,184,0.6);
      background: rgba(255,255,255,0.92);
      box-shadow:0 8px 20px rgba(15,23,42,0.08);
      font-size:1.4rem;
      z-index:50;
    }
    html[data-theme="dark"] .theme-toggle-btn{ background: rgba(15,23,42,0.9); color:#f9fafb; }

    .nav-toggle{ display:none; }
    .nav-mobile{ display:none; }

    @media (max-width:900px){
      .nav-right-links, .nav-left-links{ display:none !important; }
      .nav.nav-centered{ justify-content:center; min-height:70px; }

      .nav-toggle{
        display:flex;
        position:absolute;
        left:12px;
        top:50%;
        transform: translateY(-50%);
        flex-direction:column;
        gap:4px;
        background:none;
        border:none;
        cursor:pointer;
        z-index:9999;
      }
      .nav-toggle span{ width:22px; height:2px; background:#0f172a; }
      html[data-theme="dark"] .nav-toggle span{ background:#e5e7eb; }

      #theme-toggle.theme-toggle-btn{
        position:absolute;
        right:12px;
        top:50%;
        transform: translateY(-50%);
        z-index:9999;
      }

      #nav-mobile.nav-mobile{
        display:none;
        position:absolute;
        top: calc(100% + 10px);
        left: 6px;
        width: min(220px, calc(100% - 24px));
        background: rgba(255,255,255,0.98);
        border:1px solid rgba(148,163,184,0.45);
        border-radius:18px;
        padding:8px;
        box-shadow:0 18px 45px rgba(15,23,42,0.18);
        z-index:9999;
      }
      html[data-theme="dark"] #nav-mobile.nav-mobile{
        background: rgba(15,23,42,0.95);
        border-color: rgba(148,163,184,0.35);
      }
      #nav-mobile.nav-mobile.open{ display:block; }

      #nav-mobile.nav-mobile a{
        display:block;
        padding:9px 10px;
        border-radius:12px;
        margin:6px 0;
        background: rgba(255,255,255,0.9);
        border:1px solid rgba(148,163,184,0.45);
        color:#0f172a;
        font-weight:600;
      }
      html[data-theme="dark"] #nav-mobile.nav-mobile a{
        background: rgba(2,6,23,0.55);
        border-color: rgba(148,163,184,0.25);
        color:#e5e7eb;
      }
    }

    .home-class-card{ width:100%; max-width:680px; margin:0 auto; text-align:center; padding:18px; }
    .home-class-row{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; }
    .home-class-row .select{ min-width:160px; }

    #urgent-wrap{ width:100%; }
    .urgent-bar{
      width:min(1200px, calc(100% - 28px));
      margin:18px auto;
      padding:10px 14px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.35);
      background: rgba(251,191,36,.14);
      overflow:hidden;
    }
    .urgent-inner{ display:flex; align-items:center; gap:12px; }
    .urgent-badge{
      flex-shrink:0;
      font-weight:900;
      padding:6px 12px;
      border-radius:999px;
      background: rgba(15,23,42,.15);
      white-space:nowrap;
    }
    .urgent-marquee{ overflow:hidden; flex:1; }
    .urgent-marquee-text{
      display:inline-block;
      direction:rtl;
      unicode-bidi: plaintext;
      font-weight:900;
      white-space:nowrap;
      will-change: transform;
      animation: urgentMarquee var(--urgent-speed, 14s) linear infinite;
      background: linear-gradient(90deg, #2563eb, #0f172a, #f59e0b);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    @keyframes urgentMarquee{
      from{ transform: translateX(0); }
      to{ transform: translateX(-100%); }
    }
    @media (max-width:768px){
      .urgent-marquee-text{ animation-duration:22s; padding-right:24px; }
    }


    /* ADMIN â€“ ×›×—×•×œ ×‘×¨×•×¨ */
    html[data-theme="dark"] .nav-side a.btn-outline,
    html[data-theme="dark"] .nav-side a[href*="admin"]{
      background: rgba(37, 99, 235, 0.85);
      color: #ffffff;
      border: 1px solid rgba(147,197,253,0.6);
      box-shadow:
        0 8px 26px rgba(37,99,235,0.45),
        0 0 0 1px rgba(255,255,255,0.08) inset;
    }

    html[data-theme="dark"] .nav-side a[href*="admin"]:hover{
      background: #2563eb;
      box-shadow:
        0 14px 40px rgba(37,99,235,0.65),
        0 0 24px rgba(56,189,248,0.45);
      transform: translateY(-1px);
    }

    html[data-theme="dark"] .nav-side .personal-btn{
      background: linear-gradient(135deg,#38bdf8,#2563eb) !important;
      color: #ffffff !important;
      border: none !important;
      box-shadow:
        0 14px 42px rgba(37,99,235,0.55),
        0 0 26px rgba(56,189,248,0.45);
      font-weight: 900;
      letter-spacing: .3px;
    }
    html[data-theme="dark"] .nav-side .personal-btn:hover{
      filter: brightness(1.08);
      transform: translateY(-2px);
      box-shadow:
        0 18px 55px rgba(37,99,235,0.75),
        0 0 36px rgba(56,189,248,0.65);
    }

    /* ADMIN â€“ Light Mode */
    html[data-theme="light"] .nav-side a.btn-outline,
    html[data-theme="light"] .nav-side a[href*="admin"]{
      background: linear-gradient(135deg,#e0ecff,#c7ddff);
      color: #1d4ed8;
      border: 1px solid #93c5fd;
      box-shadow:
        0 6px 18px rgba(37,99,235,0.18),
        0 0 0 1px rgba(255,255,255,0.8) inset;
      font-weight: 700;
    }
    html[data-theme="light"] .nav-side a[href*="admin"]:hover{
      background: #2563eb;
      color: #ffffff;
      box-shadow: 0 12px 34px rgba(37,99,235,0.35);
      transform: translateY(-1px);
    }

    html[data-theme="light"] .nav-side .personal-btn{
      background: linear-gradient(135deg,#2563eb,#38bdf8) !important;
      color: #ffffff !important;
      border: none !important;
      box-shadow:
        0 10px 30px rgba(37,99,235,0.35),
        0 0 0 1px rgba(255,255,255,0.35) inset;
      font-weight: 900;
      letter-spacing: .25px;
    }
    html[data-theme="light"] .nav-side .personal-btn:hover{
      filter: brightness(1.06);
      transform: translateY(-2px);
      box-shadow: 0 16px 44px rgba(37,99,235,0.45);
    }


/* 1) ×œ×”×¤×•×š ××ª ×”××¢×‘×¨ ×œ"×—×œ×§" */
.hero-home-cards .grade-card{
  will-change: transform, background-color, box-shadow, border-color;
  transition:
    transform .28s ease,
    background-color .28s ease,
    box-shadow .28s ease,
    border-color .28s ease;
}

.hero-home-cards .grade-card:hover{
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;

  background: rgba(255,255,255,0.78) !important; /* ×—×œ×§ ×•×œ× ×§×™×¦×•× ×™ */
  transform: translateY(-4px) !important;
  box-shadow: 0 18px 45px rgba(15,23,42,0.18) !important;
  border-color: rgba(37,99,235,0.22) !important;
}

/* 3) ×‘×“××¨×§ â€“ ××•×ª×• ×¨×¢×™×•×Ÿ */
html[data-theme="dark"] .hero-home-cards .grade-card:hover{
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;

  background: rgba(15,23,42,0.70) !important;
  transform: translateY(-4px) !important;
  box-shadow: 0 18px 45px rgba(0,0,0,0.45) !important;
  border-color: rgba(56,189,248,0.25) !important;
}

@media (hover: none){
  .hero-home-cards .grade-card:active,
  .hero-home-cards .grade-card:focus-within{
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background: rgba(255,255,255,0.78) !important;
  }
  html[data-theme="dark"] .hero-home-cards .grade-card:active,
  html[data-theme="dark"] .hero-home-cards .grade-card:focus-within{
    background: rgba(15,23,42,0.70) !important;
  }
}

/* ×‘×¨×™×¨×ª ××—×“×œ: ×©×™×”×™×” ××¢×‘×¨ ×¢×“×™×Ÿ ×¨×§ ×‘×¦×‘×¢×™× (×œ× ×¤×™×œ×˜×¨×™×/blur) */
html, body, .header-main, .section-light, .section-dark-strong, .grade-card,
.nav-side a, .theme-toggle-btn, .btn, .btn-outline {
  transition: background-color .22s ease, color .22s ease, border-color .22s ease, box-shadow .22s ease;
}

/* âœ… ×‘×–××Ÿ ×”×—×œ×¤×ª ×“××¨×§/×œ×™×™×˜: ××‘×˜×œ ×”×›×œ ×›×“×™ ×©×œ× ×ª×¨××” "×‘×™× ×™×™×" ××›×•×¢×¨ */
html.theme-changing *,
html.theme-changing *::before,
html.theme-changing *::after {
  transition: none !important;
  animation: none !important;
}
    body[data-page="polls"] {
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%);
      color: #e5f0ff;
    }

    .polls-page-wrapper {
      padding-top: 90px;
      min-height: 100vh;
    }

    .polls-hero {
      padding: 24px 0 8px;
    }

    .polls-hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 2.4fr) minmax(0, 1.6fr);
      gap: 18px;
      align-items: stretch;
    }

    @media (max-width: 900px) {
      .polls-hero-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .polls-hero-main {
      border-radius: 28px;
      padding: 20px 20px 18px;
      background:
        radial-gradient(circle at top right, rgba(56, 189, 248, 0.18), transparent 55%),
        radial-gradient(circle at bottom left, rgba(96, 165, 250, 0.15), transparent 55%),
        rgba(15, 23, 42, 0.93);
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
    }

    .polls-hero-title-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .polls-badge {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      background: rgba(56, 189, 248, 0.12);
      border: 1px solid rgba(56, 189, 248, 0.7);
      color: #7dd3fc;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .polls-hero-title {
      font-size: 1.7rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .polls-hero-subtitle {
      margin-top: 4px;
      font-size: 0.95rem;
      color: #cbd5f5;
      max-width: 520px;
      line-height: 1.6;
    }

    .polls-hero-actions {
      margin-top: 12px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-primary-glow {
      border-radius: 999px;
      padding: 10px 18px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #ecfdf5;
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.7),
        0 18px 40px rgba(22, 163, 74, 0.55);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .btn-primary-glow span {
      font-size: 1rem;
    }

    .btn-soft {
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.85rem;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .polls-hero-meta {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .polls-chip {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.85);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .polls-chip strong {
      color: #e5f0ff;
    }

    .polls-hero-stats {
      border-radius: 24px;
      padding: 16px 16px 14px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.8);
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 500px) {
      .polls-hero-stats {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .stat-card {
      border-radius: 18px;
      padding: 10px 12px;
      background: radial-gradient(circle at top, rgba(59, 130, 246, 0.28), transparent 60%);
      border: 1px solid rgba(96, 165, 250, 0.7);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .stat-card.secondary {
      background: radial-gradient(circle at top, rgba(22, 163, 74, 0.28), transparent 60%);
      border-color: rgba(34, 197, 94, 0.7);
    }

    .stat-label {
      font-size: 0.75rem;
      color: #bfdbfe;
    }

    .stat-value {
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .stat-sub {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    /* ===== ×¨×©×™××ª ×¡×§×¨×™× ===== */

    .polls-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0 14px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .polls-filter-group {
      display: inline-flex;
      border-radius: 999px;
      padding: 3px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.8);
      gap: 4px;
    }

    .polls-filter-btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      border: none;
      background: transparent;
      color: #cbd5f5;
      cursor: pointer;
    }

    .polls-filter-btn.active {
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: #eff6ff;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.9);
    }

    .polls-caption {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .polls-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 40px;
    }

    .poll-card {
      border-radius: 22px;
      padding: 14px 16px 12px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.85);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .poll-header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      flex-wrap: wrap;
    }

    .poll-question {
      font-size: 1rem;
      font-weight: 600;
    }

    .poll-meta {
      font-size: 0.75rem;
      color: #9ca3af;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .poll-meta span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .poll-status-pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.75rem;
      border: 1px solid rgba(56, 189, 248, 0.7);
      background: rgba(56, 189, 248, 0.14);
      color: #bae6fd;
      white-space: nowrap;
    }

    .poll-status-pill.closed {
      border-color: rgba(248, 113, 113, 0.7);
      background: rgba(248, 113, 113, 0.12);
      color: #fecaca;
    }

    .poll-options {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .poll-option-row {
      border-radius: 999px;
      padding: 6px 8px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.9);
      display: flex;
      align-items: center;
      gap: 8px;
      overflow: hidden;
      position: relative;
    }

    .poll-option-btn {
      flex: 1;
      border-radius: 999px;
      padding: 6px 10px;
      border: none;
      background: transparent;
      color: #e5e7eb;
      text-align: right;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .poll-option-btn.disabled {
      cursor: default;
    }

    .poll-option-label {
      position: relative;
      z-index: 1;
    }

    .poll-option-bar {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.2), rgba(59, 130, 246, 0.6));
      transform-origin: right center;
      transform: scaleX(0);
      opacity: 0;
      transition: transform 0.25s ease-out, opacity 0.12s ease-out;
    }

    .poll-option-bar.visible {
      transform: scaleX(1);
      opacity: 1;
    }

    .poll-option-votes {
      position: relative;
      z-index: 1;
      font-size: 0.75rem;
      color: #dbeafe;
      white-space: nowrap;
    }

    .poll-cta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: #9ca3af;
      gap: 8px;
      flex-wrap: wrap;
    }

    .poll-cta-row strong {
      color: #e5f0ff;
    }

    .poll-locked {
      color: #fca5a5;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .poll-empty-msg {
      text-align: center;
      font-size: 0.9rem;
      color: #9ca3af;
      padding: 18px 0;
    }

    .polls-note {
      font-size: 0.75rem;
      color: #6b7280;
      text-align: center;
      margin-top: 10px;
    }

    .polls-note strong {
      color: #e5f0ff;
    }

    /* ===== OVERRIDES ×œ×œ×™×™×˜ ××•×“ â€“ ×§×œ×¤×™× ×œ×‘× ×™× ===== */
    html[data-theme="light"] body[data-page="polls"] {
      background: #eef3fb;
      color: #0f172a;
    }

    /* ×›×¨×˜×™×¡×™ ×”×™×¨×• ×•×¡×˜×˜×™×¡×˜×™×§×•×ª */
    html[data-theme="light"] .polls-hero-main,
    html[data-theme="light"] .polls-hero-stats {
      background: #ffffff;
      border-color: #e5e7eb;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
      color: #0f172a;
    }

    html[data-theme="light"] .stat-card,
    html[data-theme="light"] .stat-card.secondary {
      background: #ffffff;
      border-color: #e5e7eb;
    }

    /* ×›×¨×˜×™×¡×™ ×”×¡×§×¨×™× ×‘×¨×©×™××” */
    html[data-theme="light"] .poll-card {
      background: #ffffff;
      border-color: #e5e7eb;
      box-shadow: 0 14px 35px rgba(15, 23, 42, 0.10);
      color: #0f172a;
    }

    /* ×©×•×¨×ª ×¤×™×œ×˜×¨×™× */
    html[data-theme="light"] .polls-filter-group {
      background: #ffffff;
      border-color: #e5e7eb;
    }

    html[data-theme="light"] .polls-filter-btn {
      color: #1f2937;
    }

    /* ×©×•×¨×” ×©×œ ××•×¤×¦×™×•×ª */
    html[data-theme="light"] .poll-option-row {
      background: #f9fafb;
      border-color: #e5e7eb;
    }

    html[data-theme="light"] .poll-option-btn {
      color: #111827;
    }

    html[data-theme="light"] .poll-option-votes {
      color: #4b5563;
    }

    /* ×˜×§×¡×˜×™× */
    html[data-theme="light"] .polls-hero-title,
    html[data-theme="light"] .poll-question {
      color: #111827;
    }

    html[data-theme="light"] .polls-hero-subtitle,
    html[data-theme="light"] .polls-caption,
    html[data-theme="light"] .poll-meta,
    html[data-theme="light"] .polls-note {
      color: #4b5563;
    }

    /* ×›×¤×ª×•×¨ ×”××©× ×™ */
    html[data-theme="light"] .btn-soft {
      background: #eff6ff;
      border-color: #cbd5e1;
      color: #1f2937;
    }
  </style>
</head>

<body data-page="polls">
  <!-- ×× ×œ×™×˜×™×§×•×ª -->
  <script type="module" src="analytics.js"></script>

  <!-- HEADER ×›××• ×‘×©××¨ ×”××ª×¨ -->
     <header class="header-main">
  <div class="container">
    <nav class="nav nav-centered" aria-label="× ×™×•×•×˜ ×¨××©×™">

      <div class="nav-side nav-right-links">
        <a href="index.html#home-news">×—×“×©×•×ª</a>
        <a href="index.html#grades">×”×©×›×‘×•×ª</a>
        <a href="polls.html">×¡×§×¨×™×</a>
        <a href="about.html">××•×“×•×ª</a>
      </div>

      <div class="nav-center">
        <a href="index.html" class="logo-circle" aria-label="×“×£ ×”×‘×™×ª">
          <img
            src="https://i.ibb.co/tp4K737Y/Cropped-circle-image-1.png"
            alt="×¡××œ ×™×¢×¨×ª ×”×¢××§"
            class="logo-img"
          />
        </a>
      </div>

<div class="nav-side nav-left-links">
  <a href="redirect-edu.html" class="personal-btn">×œ××¨×—×‘ ×”××™×©×™</a>
  <a href="admin.html" class="btn-outline">Admin</a>
  <a href="teachers.html" class="teacher-portal-btn">
   ×¤×•×¨×˜×œ ××•×¨×™×
</a>

</div>


      <button id="theme-toggle" class="theme-toggle-btn" type="button" aria-label="××¦×‘ ×›×”×”/×‘×”×™×¨">
        ğŸŒ™
      </button>

      <button
        class="nav-toggle"
        id="nav-toggle"
        type="button"
        aria-label="×¤×ª×— ×ª×¤×¨×™×˜"
        aria-expanded="false"
        aria-controls="nav-mobile"
      >
        <span></span><span></span><span></span>
      </button>

      <div class="nav-mobile" id="nav-mobile" aria-hidden="true">
        <a href="index.html#home-news">×—×“×©×•×ª</a>
        <a href="index.html#home-exams">××‘×—× ×™×</a>
<a href="index.html#home-class-picker">×”×©×›×‘×•×ª</a>
        <a href="polls.html">×¡×§×¨×™×</a>
        <a href="about.html">××•×“×•×ª</a>
        <a href="index.html#contact">×™×¦×™×¨×ª ×§×©×¨</a>
        <a href="redirect-edu.html" class="personal-btn">×œ××¨×—×‘ ×”××™×©×™</a>
          <a href="teachers.html" class="teacher-portal-btn">
   ×¤×•×¨×˜×œ ××•×¨×™×
        <a href="admin.html" class="btn-outline">Admin</a>
        
      </div>

    </nav>
  </div>
</header>

  <main class="polls-page-wrapper">
    <section class="polls-hero">
      <div class="container">
        <div class="polls-hero-grid">
          <div class="polls-hero-main">
            <div class="polls-hero-title-row">
              <div class="polls-badge">
                <span>âœ¨</span>
                <span>×ª×œ××™×“×™× ××¦×‘×™×¢×™×, ×”× ×”×œ×” ××§×©×™×‘×”</span>
              </div>
            </div>

            <h1 class="polls-hero-title">×¡×§×¨×™ ×ª×œ××™×“×™× â€“ ×“×¢×ª×›× ×§×•×‘×¢×ª</h1>
            <p class="polls-hero-subtitle">
              ×‘×›×œ ×¨×’×¢ ×™×›×•×œ ×œ×”×™×¤×ª×— ×¡×§×¨ ×—×“×©: ×¢×œ ×˜×™×•×œ×™×, ×™××™ ×©×™×, ×ª×œ×‘×•×©×ª, ×©×¢×” ××¤×§×˜×™×‘×™×ª,
              ×¨×¢×™×•× ×•×ª ×œ×©×™×¤×•×¨ ×‘×™×ª ×”×¡×¤×¨ ×•×¢×•×“. ×‘×—×¨×• ×ª×©×•×‘×”, ×”×¦×‘×™×¢×•, ×•×ª×¨××• ×‘×–××Ÿ ×××ª ××™×š
              ×©××¨ ×”×ª×œ××™×“×™× ×—×•×©×‘×™×.
            </p>

            <div class="polls-hero-actions">
              <a href="#polls-list" class="btn-primary-glow">
                <span>ğŸš€</span>
                <span>×œ×§×¤×™×¦×” ×™×©×¨ ×œ×¡×§×¨×™× ×”×¤×¢×™×œ×™×</span>
              </a>

              <button id="show-all-polls" class="btn-soft" type="button">
                <span>ğŸ“Š</span>
                <span>×”×¦×’ ×’× ×¡×§×¨×™× ×™×©× ×™×</span>
              </button>
            </div>

            <div class="polls-hero-meta">
              <span class="polls-chip">
                <span>ğŸ§‘â€ğŸ“</span>
                <strong>×œ×›×œ ×ª×œ××™×“×™ ×–'-×˜'</strong>
              </span>
              <span class="polls-chip">
                <span>â±ï¸</span>
                ×”×¦×‘×¢×” ××”×™×¨×”, ×ª×•×¦××” ×‘×–××Ÿ ×××ª
              </span>
            </div>
          </div>

          <aside class="polls-hero-stats">
            <div class="stat-card">
              <div class="stat-label">×¡×§×¨×™× ×¤×¢×™×œ×™× ×›×¨×’×¢</div>
              <div class="stat-value" id="stats-active-polls">0</div>
              <div class="stat-sub">×¡×§×¨×™× ×©×¤×ª×•×—×™× ×œ×”×¦×‘×¢×”</div>
            </div>
            <div class="stat-card secondary">
              <div class="stat-label">××¡×¤×¨ ×”×¦×‘×¢×•×ª ×›×•×œ×œ</div>
              <div class="stat-value" id="stats-total-votes">0</div>
              <div class="stat-sub">×›××” ×”×¦×‘×¢×•×ª ×‘×•×¦×¢×• ×‘×¡×š ×”×›×•×œ</div>
            </div>
          </aside>
        </div>
      </div>
    </section>

    <section id="polls-section">
      <div class="container">
        <div class="polls-toolbar">
          <div class="polls-filter-group">
            <button
              type="button"
              class="polls-filter-btn active"
              id="filter-active"
            >
              ×¨×§ ×¡×§×¨×™× ×¤×ª×•×—×™×
            </button>
            <button
              type="button"
              class="polls-filter-btn"
              id="filter-all"
            >
              ×›×œ ×”×¡×§×¨×™×
            </button>
          </div>

          <div class="polls-caption">
            ×× ××ª×” ×¨×•××” ğŸ”’ â€“ ×›×‘×¨ ×”×¦×‘×¢×ª ×‘×¡×§×¨ ×”×–×” ××”××›×©×™×¨ ×”×–×”.
          </div>
        </div>

        <div id="polls-list" class="polls-list">
          <!-- ×××•×œ× ×“×¨×š JS -->
        </div>

        <p class="polls-note">
   
        </p>
      </div>
    </section>
  </main>

  <footer>
  Â© ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª ×œ×‘×™×ª ×¡×¤×¨ ×™×¢×¨×ª ×”×¢××§ Â·
  Developed By
  <a
    class="footer-devlink"
    href="https://ptzwebsitebuilding.vercel.app/"
    target="_blank"
    rel="noopener noreferrer"
  >Peretzinho</a></a>
  </footer>

  <div id="to-top">â†‘</div>

  <script src="accessibility.js"></script>

  <!-- JS â€“ ×˜×¢×™× ×ª ×¡×§×¨×™×, ×”×¦×‘×¢×”, ×ª×¦×•×’×ª ×ª×•×¦××•×ª -->
  <script type="module">
import { db } from "./firebase-config.js";

import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

import {
  collection,
  onSnapshot,
  doc,
  setDoc,
  updateDoc,
  serverTimestamp,
  increment,
  writeBatch
} from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
const auth = getAuth();
signInAnonymously(auth).catch((e) => console.error("anon auth failed:", e));

function getUid() {
  return auth.currentUser?.uid || null;
}

    const pollsColRef = collection(db, "polls");

    let pollsRaw = [];
    let showOnlyActive = true;
    let localVotes = {};
    const LOCAL_KEY = "yaarat_polls_votes";

    const pollsListEl = document.getElementById("polls-list");
    const activeStatsEl = document.getElementById("stats-active-polls");
    const totalVotesStatsEl = document.getElementById("stats-total-votes");

    const filterActiveBtn = document.getElementById("filter-active");
    const filterAllBtn = document.getElementById("filter-all");
    const showAllHeroBtn = document.getElementById("show-all-polls");
function getAnonId() {
  const k = "poll_anon_id";
  let v = localStorage.getItem(k);
  if (!v) {
    v = (crypto?.randomUUID?.() || ("anon_" + Math.random().toString(36).slice(2)));
    localStorage.setItem(k, v);
  }
  return v;
}

    function loadLocalVotes() {
      try {
        const raw = localStorage.getItem(LOCAL_KEY);
        if (!raw) {
          localVotes = {};
          return;
        }
        const parsed = JSON.parse(raw);
        if (parsed && typeof parsed === "object") {
          localVotes = parsed;
        } else {
          localVotes = {};
        }
      } catch {
        localVotes = {};
      }
    }

    function saveLocalVotes() {
      try {
        localStorage.setItem(LOCAL_KEY, JSON.stringify(localVotes));
      } catch {
        // ×× localStorage ×—×¡×•× â€“ × ×ª×¢×œ×
      }
    }
await batch.commit();

localVotes[pollId] = optionId;
saveLocalVotes();
renderPolls();   // âœ… ×–×”! ×ª×¨××” ×™×©×¨

    function calcStats() {
      let activeCount = 0;
      let totalVotes = 0;

      pollsRaw.forEach((poll) => {
        if (poll.isActive) activeCount++;
const pollVotes = (poll.options || []).reduce((sum, opt) => {
  const v = poll.counts?.[opt.id] || 0;
  return sum + v;
}, 0);

        totalVotes += pollVotes;
      });

      if (activeStatsEl) activeStatsEl.textContent = String(activeCount);
      if (totalVotesStatsEl) totalVotesStatsEl.textContent = String(totalVotes);
    }

    function renderPolls() {
      if (!pollsListEl) return;

      const pollsToShow = showOnlyActive
        ? pollsRaw.filter((p) => p.isActive)
        : pollsRaw.slice().sort((a, b) => {
            const aActive = a.isActive ? 1 : 0;
            const bActive = b.isActive ? 1 : 0;
            if (aActive !== bActive) return bActive - aActive;
            return 0;
          });

      if (!pollsToShow.length) {
        pollsListEl.innerHTML = `
          <p class="poll-empty-msg">
            ×›×¨×’×¢ ××™×Ÿ ×¡×§×¨×™× ×œ×”×¦×‘×¢×”. ×—×›×• ×§×¦×ª â€“ ××•×¢×¦×ª ×ª×œ××™×“×™×/×¦×•×•×ª ×™×¢×œ×• ×¡×§×¨ ×—×“×© ğŸ˜‰
          </p>
        `;
        return;
      }

      pollsListEl.innerHTML = "";
      pollsToShow.forEach((poll) => {
        const card = createPollCard(poll);
        pollsListEl.appendChild(card);
      });
    }

    function createPollCard(poll) {
      const card = document.createElement("article");
      card.className = "poll-card";

const totalVotes = (poll.options || []).reduce((sum, opt) => {
  const v = (poll.counts && poll.counts[opt.id]) ? poll.counts[opt.id] : 0;
  return sum + v;
}, 0);

      const alreadyVotedOptionId = localVotes[poll.id] || null;
      const isClosed = !poll.isActive;

      // ×›×•×ª×¨×ª + ×¡×˜×˜×•×¡
      const headerRow = document.createElement("div");
      headerRow.className = "poll-header-row";

      const left = document.createElement("div");
      const qEl = document.createElement("div");
      qEl.className = "poll-question";
      qEl.textContent = poll.question || "×¡×§×¨ ×œ×œ× ×©××œ×”?";

      const meta = document.createElement("div");
      meta.className = "poll-meta";
      const votesSpanHeader = document.createElement("span");
      votesSpanHeader.innerHTML = `<span dir="ltr">${totalVotes}</span>&nbsp;×”×¦×‘×¢×•×ª ×¢×“ ×¢×›×©×™×•`;
      meta.appendChild(votesSpanHeader);

      left.appendChild(qEl);
      left.appendChild(meta);

      const right = document.createElement("div");

      const statusPill = document.createElement("div");
      statusPill.className = "poll-status-pill" + (isClosed ? " closed" : "");
      statusPill.textContent = isClosed ? "×¡×§×¨ × ×¡×’×¨" : "×¡×§×¨ ×¤×¢×™×œ";

      right.appendChild(statusPill);

      headerRow.appendChild(left);
      headerRow.appendChild(right);

      // ××•×¤×¦×™×•×ª
      const optionsContainer = document.createElement("div");
      optionsContainer.className = "poll-options";

      (poll.options || []).forEach((opt) => {
        const row = document.createElement("div");
        row.className = "poll-option-row";

        const bar = document.createElement("div");
        bar.className = "poll-option-bar";

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "poll-option-btn";

        const labelSpan = document.createElement("span");
        labelSpan.className = "poll-option-label";
        labelSpan.textContent = opt.text || "";

        const votesSpan = document.createElement("span");
        votesSpan.className = "poll-option-votes";

const votes = (poll.counts && poll.counts[opt.id]) ? poll.counts[opt.id] : 0;
        const percent =
          totalVotes > 0 ? Math.round((votes / totalVotes) * 100) : 0;

        // ×”×¦×’×ª "××¡×¤×¨ ×§×•×œ×•×ª (××—×•×–%)" ×¢× ×¨×•×•×—×™× ×ª×§×™× ×™× ×‘-RTL
        if (totalVotes === 0) {
          votesSpan.innerHTML = `
            <span dir="ltr">${votes}</span>&nbsp;<span>×§×•×œ×•×ª</span>
          `;
        } else {
          votesSpan.innerHTML = `
            <span dir="ltr">${votes}</span>&nbsp;<span>×§×•×œ×•×ª</span>
            &nbsp;(<span dir="ltr">${percent}%</span>)
          `;
        }

        btn.appendChild(labelSpan);
        btn.appendChild(votesSpan);

        const canVote = poll.isActive && !alreadyVotedOptionId;

        if (!canVote) {
          btn.classList.add("disabled");
        }

        if (!canVote && totalVotes > 0) {
          bar.style.transformOrigin = "right center";
          bar.style.transform = "scaleX(" + Math.max(percent / 100, 0.05) + ")";
          bar.classList.add("visible");
        }

        if (canVote) {
          btn.addEventListener("click", () => {
            handleVote(poll.id, opt.id);
          });
        }

        row.appendChild(bar);
        row.appendChild(btn);
        optionsContainer.appendChild(row);
      });

      // ×©×•×¨×” ×ª×—×ª×•× ×”
      const footerRow = document.createElement("div");
      footerRow.className = "poll-cta-row";

      const leftSide = document.createElement("div");
      if (alreadyVotedOptionId) {
        const selected = (poll.options || []).find(
          (o) => o.id === alreadyVotedOptionId
        );
        leftSide.innerHTML = `
          ×›×‘×¨ ×”×¦×‘×¢×ª ×‘×¡×§×¨ ×”×–×” ×œ:
          <strong>${selected ? selected.text : "××¤×©×¨×•×ª ×œ× ×™×“×•×¢×”"}</strong>
        `;
      } else if (!poll.isActive) {
        leftSide.innerHTML =
          '<span class="poll-locked">ğŸ”’ ×”×¡×§×¨ × ×¡×’×¨ â€“ ×”×¦×‘×¢×•×ª ×—×“×©×•×ª ×œ× ××¤×©×¨×™×•×ª.</span>';
      } else {
        leftSide.textContent = "×‘×—×¨ ××¤×©×¨×•×ª ×•×œ×—×¥ â€“ ×”×”×¦×‘×¢×” × ×¡×¤×¨×ª ××™×“.";
      }

      const rightSide = document.createElement("div");
      if (alreadyVotedOptionId) {
        rightSide.innerHTML =
          '<span class="poll-locked">ğŸ”’ ×”×¦×‘×¢×ª ×›×‘×¨ ××”××›×©×™×¨ ×”×–×”</span>';
      } else if (!poll.isActive) {
        rightSide.textContent = "××¤×©×¨ ×œ×¨××•×ª ××ª ×”×ª×•×¦××•×ª, ××‘×œ ×œ× ×œ×”×¦×‘×™×¢.";
      } else {
        rightSide.textContent = "××¤×©×¨ ×œ×”×¦×‘×™×¢ ×¤×¢× ××—×ª ×‘×œ×‘×“ ××”××›×©×™×¨ ×”×–×”.";
      }

      footerRow.appendChild(leftSide);
      footerRow.appendChild(rightSide);

      card.appendChild(headerRow);
      card.appendChild(optionsContainer);
      card.appendChild(footerRow);

      return card;
    }

async function handleVote(pollId, optionId) {
  loadLocalVotes();
  if (localVotes[pollId]) {
    alert("×›×‘×¨ ×”×¦×‘×¢×ª ×‘×¡×§×¨ ×”×–×” ××”××›×©×™×¨ ×”×–×”.");
    return;
  }

  const uid = getUid();
  if (!uid) {
    alert("×”×ª×—×‘×¨×•×ª ×× ×•× ×™××™×ª ×¢×“×™×™×Ÿ × ×˜×¢× ×ªâ€¦ × ×¡×” ×©×•×‘ ×¢×•×“ ×¨×’×¢.");
    return;
  }

  try {
    const pollRef = doc(db, "polls", pollId);
    const voteRef = doc(db, "pollVotes", `${pollId}__${uid}`);

    const batch = writeBatch(db);

    // 1) × ×•×¢×œ ×”×¦×‘×¢×” (××¡××š ××—×“ ×œ×›×œ uid ×œ×›×œ poll)
    batch.set(voteRef, {
      pollId,
      optionId,
      uid,
      createdAt: serverTimestamp()
    });

    // 2) ××¢×œ×” ××•× ×” ×ª×•×¦××•×ª (counts.<optionId> += 1)
    batch.update(pollRef, {
      [`counts.${optionId}`]: increment(1)
    });

    await batch.commit();

    localVotes[pollId] = optionId;
    saveLocalVotes();
    // onSnapshot ×™×¢×“×›×Ÿ ×ª×•×¦××•×ª ×™×©×¨
  } catch (err) {
    // ×× ×›×‘×¨ ×”×¦×‘×™×¢ => ×”-set ×™×”×¤×•×š ×œ-update ×•×™×™×—×¡× ×¢"×™ rules => permission-denied
    if (String(err?.code || "").includes("permission-denied")) {
      localVotes[pollId] = optionId;
      saveLocalVotes();
      renderPolls();
      return;
    }
    console.error("×©×’×™××” ×‘×”×¦×‘×¢×”:", err);
    alert("×”×™×™×ª×” ×‘×¢×™×” ×‘×–××Ÿ ×”×”×¦×‘×¢×”. × ×¡×• ×©×•×‘.");
  }
}



    // ===== ××™×¨×•×¢×™× ×¢×œ ×¤×™×œ×˜×¨×™× =====

    function setFilterMode(onlyActive) {
      showOnlyActive = onlyActive;
      if (onlyActive) {
        filterActiveBtn.classList.add("active");
        filterAllBtn.classList.remove("active");
      } else {
        filterActiveBtn.classList.remove("active");
        filterAllBtn.classList.add("active");
      }
      renderPolls();
    }

    if (filterActiveBtn && filterAllBtn) {
      filterActiveBtn.addEventListener("click", () => setFilterMode(true));
      filterAllBtn.addEventListener("click", () => setFilterMode(false));
    }

    if (showAllHeroBtn) {
      showAllHeroBtn.addEventListener("click", () => {
        setFilterMode(false);
        const target = document.getElementById("polls-section");
        if (target) {
          target.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
    }

    // ===== ×”×ª×—×œ×” â€“ ×××–×™×Ÿ ×‘×–××Ÿ ×××ª =====
    loadLocalVotes();

    onSnapshot(
      pollsColRef,
      (snap) => {
        pollsRaw = [];
        snap.forEach((docSnap) => {
          pollsRaw.push({
            id: docSnap.id,
            ...docSnap.data()
          });
        });
        calcStats();
        renderPolls();
      },
      (err) => {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×§×¨×™× ×‘×–××Ÿ ×××ª:", err);
        if (pollsListEl) {
          pollsListEl.innerHTML =
            '<p class="poll-empty-msg">×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¡×§×¨×™×. × ×¡×• ×œ×¨×¢× ×Ÿ ××ª ×”×“×£.</p>';
        }
      }
    );
  </script>

  <!-- app.js ×‘×©×‘×™×œ ××¦×‘ ×›×”×” / ×ª×¤×¨×™×˜ ××•×‘×™×™×œ ×•×›×•' -->
  <script type="module" src="app.js"></script>
<script type="module" src="/analytics.js"></script>

</body>
</html>